<?xml version="1.0" encoding="UTF-8" ?>
<project name="InfoService">

	<taskdef name="http"
		classname="org.missinglink.ant.task.http.HttpClientTask">
	</taskdef>

	<target name="getCurrentVersionInformation">
		<loadfile srcfile="${src_dir}/infoservice/InfoService.java"
			property="currentVersion">
			<filterchain>
				<linecontains>
					<contains
						value="public static final String INFOSERVICE_VERSION" />
				</linecontains>
				<tokenfilter>
					<stringtokenizer delims='"'
						suppressdelims="true" />
					<containsstring contains="." />
				</tokenfilter>
			</filterchain>
		</loadfile>
		<echo message="Current Version: ${currentVersion}" />
	</target>

	<target name="deploy_to_anon" depends="getCurrentVersionInformation">
		<echo message="${currentVersion}" file="${WWWDEVELOP}/infoserviceversion.txt" />
		<copy file="${signedJarFile}" tofile="${WWWDEVELOP}/InfoService.jar" />
	</target>

	<target name="deploy_to_sourceforge" depends="getCurrentVersionInformation">
		<!-- copy file to sf -->
		<scp file="${signedJarFile}"
			remoteTofile="${sf.user}@frs.sourceforge.net:/home/frs/project/anon/infoservice-development/InfoService_${currentVersion}.jar"
			password="${sf.pass}" />
		<!-- release it using REST-API -->
		<http
			url="https://sourceforge.net/projects/anon/files/infoservice-development/InfoService_${currentVersion}.jar"
			method="PUT" printrequest="true" printresponseheaders="true">
			<headers>
			<header name="Content-Type:" value="application/x-www-form-urlencoded"/>
			</headers>
			<entity>
				<![CDATA[api_key=${sf.api.key}]]>
			</entity>
					</http>
	</target>

	<target name="deploy_daily_snapshot" depends="deploy_to_anon,deploy_to_sourceforge">
	</target>

</project>